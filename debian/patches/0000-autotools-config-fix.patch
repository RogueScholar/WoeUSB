Description: Overcome deficiencies in upstream autotools configuration
Author: Peter J. Mello <admin@petermello.net>
Origin: other
Forwarded: no
Last-Update: 2019-12-19

--- a/Makefile.am
+++ b/Makefile.am
@@ -4,6 +4,7 @@ SUBDIRS = \
 	innoSetup
 
 # M4
+ACLOCAL_AMFLAGS = -I m4
 
 ## Pour fichier COPYING
 pkgdocdir=$(prefix)
--- /dev/null
+++ b/autogen.sh
@@ -0,0 +1,3 @@
+#!/bin/sh
+
+autoreconf -fi
--- a/configure.ac
+++ b/configure.ac
@@ -1,18 +1,46 @@
-AC_INIT(woeusb, @@WOEUSB_VERSION@@)
+# -*- Autoconf -*-
+# Process this file with autoconf to produce a configure script.
+
+AC_PREREQ([2.69])
+AC_INIT([WoeUSB], [3.3.0+git1a7b468], [https://github.com/slacka/WoeUSB/issues/new])
 AC_CONFIG_SRCDIR([src])
 AM_INIT_AUTOMAKE([foreign])
 AC_CONFIG_MACRO_DIR([m4])
+AM_MAINTAINER_MODE
 
 MY_PACKAGE_INIT([WoeUSB])
 
-dnl Checks for programs (must be here).
 AC_LANG([C++])
-AC_PROG_INSTALL
+
++# Checks for programs.
 AC_PROG_CXX
+AC_PROG_AWK
+AC_PROG_CC
 AC_PROG_CPP
+AC_PROG_INSTALL
 AC_PROG_LN_S
 
-dnl To compile libs
+# Checks for libraries.
+AM_OPTIONS_WXCONFIG
+reqwx=2.8.0
+AM_PATH_WXCONFIG($reqwx, wxWin=1)
+if test "$wxWin" != 1; then
+  AC_MSG_ERROR([
+	wxWidgets must be installed on your system.
+
+	Please check that wx-config is in path, the directory
+	where wxWidgets libraries are installed (returned by
+	'wx-config --libs' or 'wx-config --static --libs' command)
+	is in LD_LIBRARY_PATH or equivalent variable and
+	wxWidgets version is $reqwx or above.
+	])
+fi
+
+CPPFLAGS="$CPPFLAGS $WX_CPPFLAGS"
+CXXFLAGS="$CXXFLAGS $WX_CXXFLAGS_ONLY"
+CFLAGS="$CFLAGS $WX_CFLAGS_ONLY"
+LIBS="$LIBS $WX_LIBS"
+
 LT_INIT
 AM_PROG_LIBTOOL		dnl indique que l'on utilise Libtool pour la compilation
 AC_PROG_MAKE_SET	dnl indique que l'on doit disposer de make qui est utilis√© par Libtool
@@ -23,21 +51,26 @@ AM_FIND_WINDRES dnl Find windres is need
 
 MY_INIT_DEBUG_SWITCH([false]) dnl Allow the user tu build the program in debug mode ; doesn't edit any cpp options ; true to force debug
 
-dnl Libs
 MY_FIND_STDCPP
-MY_FIND_WXWIDGETS
 
-AC_OUTPUT([Makefile
+# Checks for header files.
+AC_CHECK_HEADERS([stdlib.h])
+
+# Checks for typedefs, structures, and compiler characteristics.
+AC_CHECK_HEADER_STDBOOL
 
-	src/Makefile
-	src/data/Makefile
-	src/linux-menu/Makefile
-	src/win32/Makefile
-	src/locale/Makefile
-	src/locale/fr/Makefile
-	src/locale/zh_TW/Makefile
-	src/locale/fr/LC_MESSAGES/Makefile
-	src/locale/zh_TW/LC_MESSAGES/Makefile
-	innoSetup/Makefile])
+# Checks for library functions.
+AC_CHECK_FUNCS([pow])
 
-MY_ECHO_BUILD_INFO # Recap
+AC_CONFIG_FILES([Makefile
+                 innoSetup/Makefile
+                 src/Makefile
+                 src/data/Makefile
+                 src/linux-menu/Makefile
+                 src/locale/Makefile
+                 src/locale/fr/LC_MESSAGES/Makefile
+                 src/locale/fr/Makefile
+                 src/locale/zh_TW/LC_MESSAGES/Makefile
+                 src/locale/zh_TW/Makefile
+                 src/win32/Makefile])
+AC_OUTPUT
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -6,7 +6,7 @@ SUBDIRS = \
 
 bin_PROGRAMS=woeusbgui
 
-INCLUDES = $(CFLAGS_ALL)
+AM_CPPFLAGS = $(CFLAGS_ALL)
 
 woeusbgui_LDFLAGS = $(EXTRA_LDFLAGS)
 	
@@ -42,7 +42,7 @@ woeusbgui_SOURCES=$(woeusbguiSrcBase) rc
 else
 woeusbgui_SOURCES=$(woeusbguiSrcBase)
 endif
-## --------------- Resources windows --------------- 
+## --------------- Resources windows ---------------
 
 # Install my_script in $(bindir) and distribute it.
 dist_bin_SCRIPTS = woeusb
